<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Tiempos</title>

<style>
body { margin: 0; padding: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }

/* --- Calculadora --- */
.calculadora {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  max-width: 360px;
  margin: 20px auto;
  padding: 10px;
  box-sizing: border-box;
  min-height: 360px; /* centrado vertical opcional */
}

.display {
  grid-column: 1 / 5;
  font-size: 1.4em;
  padding: 10px;
  text-align: right;
  border-radius: 5px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  background-color: #f0f0f0;
  min-height: 45px;
  overflow-x: auto;
}

/* Botones */
button {
  padding: 15px;
  font-size: 1.1em;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  transition: background-color 0.2s;
}

/* Color neutro números y switch (modo claro) */
button.color1 { background-color: #c0c0c0; color: #000; }

/* Color neutro números y switch (modo oscuro) */
body.modo-oscuro button.color1 { background-color: #555; color: #fff; }

/* Operaciones */
button.color2 { background-color: #5C6B73; color: #fff; }
button.color2:hover { background-color: #4A565D; }

/* Botón "=" normal */
button#igual { grid-column: auto; }

/* Switch toggle calculadora con tema */
.calculadora-switch {
  grid-column: span 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 60px;
  height: 28px;
  margin: 0 auto;
  cursor: pointer;
}

.calculadora-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.switch-slider {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #c0c0c0;
  border-radius: 14px;
  transition: 0.2s;
}

body.modo-oscuro .switch-slider { background-color: #555; }

.calculadora-switch input:checked + .switch-slider {
  background-color: #5C6B73;
}

.switch-slider::before {
  content: "";
  position: absolute;
  height: 22px;
  width: 22px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: 0.2s;
}

.calculadora-switch input:checked + .switch-slider::before {
  transform: translateX(32px);
}

</style>
</head>
<body>

<div class="calculadora">
  <input type="text" class="display" id="display" readonly>

  <!-- Switch integrado -->
<div class="switch-container calculadora-switch">
  <input type="checkbox" id="switchFormato" title="Cambiar formato h/dec">
  <span class="switch-slider"></span>
  <span id="formatoLabel" style="margin-left:6px; font-size:0.9em;">h/m/s</span>
</div>

  <!-- Fila 1 -->
  <button class="color2" data-unit="h">H</button>
  <button class="color2" data-unit="m">M</button>
  <button class="color2" data-unit="s">S</button>
  <button class="color2" data-op="÷">÷</button>

  <!-- Fila 2 -->
  <button class="color1" data-num="7">7</button>
  <button class="color1" data-num="8">8</button>
  <button class="color1" data-num="9">9</button>
  <button class="color2" data-op="×">×</button>

  <!-- Fila 3 -->
  <button class="color1" data-num="4">4</button>
  <button class="color1" data-num="5">5</button>
  <button class="color1" data-num="6">6</button>
  <button class="color2" data-op="-">-</button>

  <!-- Fila 4 -->
  <button class="color1" data-num="1">1</button>
  <button class="color1" data-num="2">2</button>
  <button class="color1" data-num="3">3</button>
  <button class="color2" data-op="+">+</button>

  <!-- Fila 5 -->
  <button class="color1" data-num="0">0</button>
  <button class="color1" id="clear">C</button>
  <button class="color1" id="igual">=</button>
</div>

<script>
// Variables principales
const display = document.getElementById('display');
let expression = '';
let modeDecimal = false;

// Switch integrado + indicador
const switchBtn = document.getElementById('switchFormato');
const formatoLabel = document.getElementById('formatoLabel');

function actualizarFormatoLabel() {
  formatoLabel.textContent = switchBtn.checked ? "decimal" : "h/m/s";
}

// Evento change del switch
switchBtn.addEventListener('change', () => {
  modeDecimal = switchBtn.checked;
  actualizarDisplay();
  actualizarFormatoLabel();
});

// Inicializar label al cargar
actualizarFormatoLabel();

// Botones numéricos
document.querySelectorAll('[data-num]').forEach(btn=>{
  btn.addEventListener('click', ()=>{ expression += btn.dataset.num; actualizarDisplay(); });
});

// Botones de unidades H/M/S
document.querySelectorAll('[data-unit]').forEach(btn=>{
  btn.addEventListener('click', ()=>{ expression += btn.dataset.unit; actualizarDisplay(); });
});

// Botones de operaciones
document.querySelectorAll('[data-op]').forEach(btn=>{
  btn.addEventListener('click', ()=>{ expression += ' ' + btn.dataset.op + ' '; actualizarDisplay(); });
});

// Botón C
document.getElementById('clear').addEventListener('click', ()=>{
  expression = '';
  actualizarDisplay();
});

// Botón =
document.getElementById('igual').addEventListener('click', ()=>{
  expression = calcular(expression);
  actualizarDisplay();
});

// Actualiza display
function actualizarDisplay(){ display.value = expression; }

// --- Lógica cálculo de tiempos ---
function calcular(exp){
  try {
    let tokens = exp.split(/\s+/).filter(t=>t!==''), stack=[], currentOp=null;
    function tokenToHours(token){
      if(token.endsWith('h')) return parseFloat(token.replace('h',''))||0;
      if(token.endsWith('m')) return (parseFloat(token.replace('m',''))||0)/60;
      if(token.endsWith('s')) return (parseFloat(token.replace('s',''))||0)/3600;
      if(!isNaN(parseFloat(token))) return parseFloat(token);
      return 0;
    }
    for(let token of tokens){
      if(['+', '-', '×', '÷'].includes(token)) currentOp = token;
      else{
        let val = tokenToHours(token);
        if(currentOp){
          if(currentOp==='+') stack.push(stack.pop() + val);
          else if(currentOp==='-') stack.push(stack.pop() - val);
          else if(currentOp==='×') stack.push(stack.pop() * val);
          else if(currentOp==='÷') stack.push(stack.pop() / val);
          currentOp = null;
        } else stack.push(val);
      }
    }
    let totalH = stack.reduce((a,b)=>a+b,0);
    if(!modeDecimal){
      let h = Math.floor(totalH);
      let m = Math.floor((totalH - h)*60);
      let s = Math.round(((totalH - h)*60 - m)*60);
      return `${h}h ${m}m ${s}s`;
    } else return totalH.toFixed(2);
  } catch(e){ return 'Error'; }
}

// Teclado físico seguro
document.addEventListener('keydown', (e)=>{
  if(e.key.match(/[0-9]/)) expression += e.key;
  else if(['h','m','s','+','-','*','/'].includes(e.key)) expression += e.key==='*'?'×': e.key==='/'?'÷': e.key;
  else if(e.key==='Enter') expression = calcular(expression);
  else if(e.key==='Backspace') expression = expression.slice(0,-1);
  actualizarDisplay();
});

// Ajuste automático altura iframe
function ajustarAltura() {
  const altura = document.body.scrollHeight;
  window.parent.postMessage({ tipo: 'ajustarAlturaCalculadora', altura }, '*');
}
window.addEventListener('load', ajustarAltura);
const observer = new MutationObserver(ajustarAltura);
observer.observe(document.body, { childList: true, subtree: true });

</script>
</body>
</html>
