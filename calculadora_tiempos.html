<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Tiempos</title>
<style>
body {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', sans-serif;
  overflow-x: hidden;
  transition: background-color 0.3s, color 0.3s;
}
body.modo-claro { background-color: #f0f0f0; color: #111; }
body.modo-oscuro { background-color: #222; color: #fff; }

.calculadora {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
  max-width: 360px;
  margin: 8px auto;
  padding: 10px;
  box-sizing: border-box;
  border-radius: 10px;
  background-color: #e0e0e0; /* Claro */
  transition: background-color 0.3s;
}
body.modo-oscuro .calculadora { background-color: #444; } /* Oscuro más claro que fondo general */

.display {
  grid-column: 1 / 5;
  font-size: 1.4em;
  padding: 10px;
  text-align: right;
  border-radius: 5px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  background-color: #e0e0e0;
  min-height: 45px;
  overflow-x: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
body.modo-oscuro .display { background-color: #666; color: #fff; }

button {
  padding: 15px;
  font-size: 1.1em;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  transition: background-color 0.2s;
}
button.color1 { background-color: #c0c0c0; color: #000; }
body.modo-oscuro button.color1 { background-color: #555; color: #fff; }
button.color1:hover { filter: brightness(0.9); }
button.color2 { background-color: #5C6B73; color: #fff; }
button.color2:hover { background-color: #4A565D; }

.switch-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin: 6px auto 12px auto;
  max-width: 360px;
}
.switch-container span { font-weight: normal; }
.switch-container input {
  appearance: none;
  -webkit-appearance: none;
  width: 50px; height: 24px;
  background: #ccc;
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s;
}
body.modo-oscuro .switch-container input { background: #555; }
.switch-container input:checked { background: #5C6B73; }
.switch-container input::before {
  content: "";
  position: absolute;
  top: 50%; left: 2px;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: #fff;
  transform: translateY(-50%);
  transition: left 0.2s;
}
.switch-container input:checked::before { left: calc(100% - 22px); }
.switch-container input:focus { outline: none; }

@media(max-width:480px) {
  .calculadora { max-width: 95%; }
  .switch-container { max-width: 95%; }
}
</style>
</head>
<body class="modo-claro">

<div class="calculadora">
  <input type="text" class="display" id="display" readonly>

  <button class="color2 btn-hms" onclick="appendValue('h')">H</button>
  <button class="color2 btn-hms" onclick="appendValue('m')">M</button>
  <button class="color2 btn-hms" onclick="appendValue('s')">S</button>
  <button class="color2" onclick="appendValue('%')">%</button>

  <button class="color1" id="parAbre">(</button>
  <button class="color1" id="parCierra">)</button>
  <button class="color1" id="borrar1">⌫</button>
  <button class="color2" data-op="÷">÷</button>

  <button class="color1" data-num="7">7</button>
  <button class="color1" data-num="8">8</button>
  <button class="color1" data-num="9">9</button>
  <button class="color2" data-op="×">×</button>

  <button class="color1" data-num="4">4</button>
  <button class="color1" data-num="5">5</button>
  <button class="color1" data-num="6">6</button>
  <button class="color2" data-op="-">-</button>

  <button class="color1" data-num="1">1</button>
  <button class="color1" data-num="2">2</button>
  <button class="color1" data-num="3">3</button>
  <button class="color2" data-op="+">+</button>

  <button class="color1" id="clear">C</button>
  <button class="color1" data-num="0">0</button>
  <button class="color1" id="coma">,</button>
  <button class="color2" id="igual">=</button>
</div>

<div class="switch-container">
  <span id="switch-text">Horas</span>
  <input type="checkbox" id="switchFormato" checked onchange="toggleMode()">
</div>

<script>
let expression = "";
let modeDecimal = false; // Arranca en Horas, switch encendido
const display = document.getElementById("display");

const traduccionesSwitch = {
  es: { horas: "Horas", decimal: "Decimal" },
  ca: { horas: "Hores", decimal: "Decimal" },
  gl: { horas: "Horas", decimal: "Decimal" },
  eu: { horas: "Orduak", decimal: "Desimalak" }
};

function appendValue(val) {
  if (['h','m','s'].includes(val)) {
    if(expression.length > 0 && !isNaN(expression.slice(-1))) expression += val + " ";
  } else {
    expression += val;
  }
  display.value = expression;
}

function clearDisplay() { expression=""; display.value=""; }
function backspace() { expression=expression.trim().slice(0,-1); display.value=expression; }

function calcular(exp) {
  try {
    if(modeDecimal){
      exp = exp.replace(/×/g,'*').replace(/÷/g,'/').replace(/%/g,'/100');
      let res = eval(exp);
      if(res===null||res===undefined||isNaN(res)) return "Error";
      return res.toString();
    } else {
      let expCopy = exp.replace(/(\d+(\.\d+)?)h/g,"($1)")
                       .replace(/(\d+(\.\d+)?)m/g,"($1/60)")
                       .replace(/(\d+(\.\d+)?)s/g,"($1/3600)")
                       .replace(/×/g,'*').replace(/÷/g,'/').replace(/%/g,'/100');
      let totalH = eval(expCopy);
      if(totalH===null||totalH===undefined||isNaN(totalH)) return "Error";
      let h=Math.floor(totalH);
      let rem=(totalH-h)*60;
      let m=Math.floor(rem);
      let s=Math.round((rem-m)*60);
      if(s>=60){ m+=Math.floor(s/60); s%=60; }
      if(m>=60){ h+=Math.floor(m/60); m%=60; }
      return `${h}h ${m}m ${s}s`;
    }
  } catch(e){ return "Error"; }
}

function calculateResult() {
  const result = calcular(expression);
  display.value = result;
  expression="";
}

function toggleMode() {
  const switchInput = document.getElementById("switchFormato");
  modeDecimal = !switchInput.checked;
  document.getElementById("switch-text").textContent = modeDecimal ? getCurrentLangText().decimal : getCurrentLangText().horas;
  document.querySelectorAll(".btn-hms").forEach(btn => btn.disabled=modeDecimal);
  clearDisplay();
}

// Conectar botones
document.getElementById("clear").addEventListener("click", clearDisplay);
document.getElementById("igual").addEventListener("click", calculateResult);
document.getElementById("parAbre").addEventListener("click", () => appendValue("("));
document.getElementById("parCierra").addEventListener("click", () => appendValue(")"));
document.getElementById("coma").addEventListener("click", () => appendValue("."));
document.getElementById("borrar1").addEventListener("click", backspace);
document.querySelectorAll("button[data-num]").forEach(btn=>btn.addEventListener("click", ()=>appendValue(btn.dataset.num)));
document.querySelectorAll("button[data-op]").forEach(btn=>btn.addEventListener("click", ()=>appendValue(btn.dataset.op)));
document.querySelectorAll(".btn-hms").forEach(btn=>btn.disabled=modeDecimal);

// Traducción del switch vía postMessage
let currentLang = 'es';
function getCurrentLangText(){ return traduccionesSwitch[currentLang] || traduccionesSwitch.es; }

window.addEventListener('message', (event)=>{
  if(event.data?.type==='cambiarIdioma'){
    currentLang = event.data.lang;
    document.getElementById('switch-text').textContent = modeDecimal ? getCurrentLangText().decimal : getCurrentLangText().horas;
  } else if(event.data?.type==='cambiarModo'){
    // Para sincronizar modo oscuro/claro
    if(event.data.modo==='oscuro'){ document.body.classList.replace('modo-claro','modo-oscuro'); }
    else{ document.body.classList.replace('modo-oscuro','modo-claro'); }
  }
});
</script>
</body>
</html>
