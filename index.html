<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de tiempo</title>
<link rel="icon" type="image/png" href="favicon.png">
<style>
/* --- Estilos generales --- */
body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; margin: 0; transition: background-color 0.3s, color 0.3s, background-image 0.5s ease-in-out; }
body.modo-claro { background-image: url('./LIGHT.webp'); background-size: cover; background-position: center; background-repeat: no-repeat; color: #1a1a1a; }
body.modo-oscuro { background-image: url('./DARK.webp'); background-size: cover; background-position: center; background-repeat: no-repeat; color: #e0e0e0; }
.texto-azul { color: inherit; }
body.modo-claro .texto-azul { color: #0D47A1; }
body.modo-oscuro .texto-azul { color: #90D5FF; }
h1, h3 { margin: 10px 0; }
.reloj { font-size: 1.8em; font-weight: bold; margin: 10px 0; }
.zona, #semanaActual { font-size: 1em; font-weight: normal; margin: 10px 0; color: inherit; }
.seccion { margin: 20px auto; padding: 15px; border-radius: 8px; max-width: 600px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); background-color: rgba(255,255,255,0.9);}
body.modo-oscuro .seccion { background-color: rgba(50,50,50,0.9); }
input, button { padding: 10px; margin: 5px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; width: 90%; max-width: 300px; box-sizing: border-box;}
button { background-color: #3498db; color: white; border: none; cursor: pointer; transition: background-color 0.2s; }
button:hover { background-color: #2980b9; }
#modo-toggle { position: fixed; right: clamp(10px, 2vw, 24px); bottom: clamp(10px, 2vw, 24px); font-size: clamp(1.25rem, 0.9rem + 1vw, 1.75rem); background: none; border: none; cursor: pointer; color: inherit; z-index: 1000; line-height: 1; -webkit-tap-highlight-color: transparent; }
#modo-toggle:focus { outline: 2px solid #3498db; }
.calendar-container { max-width: 90%; margin: 20px auto; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.calendar-container iframe { width: 100%; height: 300px; border: none; }
.firma { margin-top: 15px; font-size: 0.8em; text-align: center; opacity: 0.7; }
body.modo-claro .firma { color: #666; }
body.modo-oscuro .firma { color: #aaa; }
.error { color: orange; font-weight: bold; font-style: italic; font-size: 0.9em; margin-top: 5px; opacity: 0; transition: opacity 0.4s; display: flex; align-items: center; justify-content: center; }
.error.visible { opacity: 1; }
.icono { margin-right: 5px; }
.input-error { border: 2px solid orange; animation: parpadeo 0.6s ease-in-out 2; }
@keyframes parpadeo { 0%,100%{ border-color: transparent;} 50%{ border-color: orange; } }
#idiomas { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
#idiomas img { width: 40px; height: 26px; cursor: pointer; border-radius: 4px; transition: transform 0.2s; }
#idiomas img:hover, #idiomas img.active { transform: scale(1.1); border: 2px solid #3498db; }
@media(max-width:480px) { .reloj { font-size: 1.5em;} input, button { width: 95%; } .calendar-container iframe { height: 250px; } }
@media(min-width:481px) and (max-width:768px) { input, button { max-width: 90%; } .calendar-container iframe { height: 300px; } }
#climaAnimado {position: relative; width: 100%; height: 100px; margin-top: 10px; overflow: hidden; border-radius: 8px;}
.nube, .sol, .gota, .nieve {position: absolute;}
.nube {width: 60px; height: 40px; background: #fff; border-radius: 50%; animation: moverNube 10s linear infinite; top: 20px;}
@keyframes moverNube { 0%{left:-80px;} 100%{left:100%;} }
.sol {width: 60px; height: 60px; background: yellow; border-radius: 50%; animation: brillar 2s infinite alternate; top: 10px; left: calc(50% - 30px);}
@keyframes brillar { 0%{transform: scale(1);} 100%{transform: scale(1.2);} }
.gota {width: 6px; height: 12px; background: #0cf; border-radius: 50%; animation: caer 1s linear infinite;}
@keyframes caer { 0%{top:-20px;} 100%{top:100px;} }
.nieve {width: 6px; height: 6px; background: #fff; border-radius: 50%; animation: nevar 2s linear infinite;}
@keyframes nevar { 0%{top:-10px;} 100%{top:100px;} }
</style>
</head>
<body>

<h1 class="texto-azul" id="titulo"></h1>

<div id="idiomas">
  <img src="ESP.png" alt="Espa√±ol" data-lang="es" onclick="cambiarIdioma('es')" title="Espa√±ol">
  <img src="CAT.png" alt="Catal√†" data-lang="ca" onclick="cambiarIdioma('ca')" title="Catal√†">
  <img src="GAL.png" alt="Galego" data-lang="gl" onclick="cambiarIdioma('gl')" title="Galego">
  <img src="EUS.png" alt="Euskera" data-lang="eu" onclick="cambiarIdioma('eu')" title="Euskera">
</div>

<div class="reloj texto-azul" id="reloj"></div>
<div class="zona" id="zonaHoraria"></div>
<p id="semanaActual"></p>

<div class="calendar-container">
<iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&ctz=Europe%2FMadrid&showCalendars=0&showTitle=0&title=Festivos&showTz=0&showDate=0&src=ZXMuc3BhaW4jaG9saWRheUBncm91cC52LmNhbGVuZGFyLmdvb2dsZS5jb20&color=%230b8043" style="border-width:0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
</div>

<div class="seccion" id="weather-section">
  <h3 class="texto-azul" id="h3Clima"></h3>
  <input type="text" id="ciudad" placeholder="">
  <button id="btnConsultarClima"></button>
  <div class="resultado" id="resultadoClima">
    <div id="climaAnimado"></div>
  </div>
  <p class="error" id="errorClima"><span class="icono">‚ö†Ô∏è</span></p>
</div>

<div class="seccion">
  <h3 class="texto-azul" id="h3Semana"></h3>
  <input type="date" id="fecha">
  <button id="btnCalcularSemana" onclick="calcularSemana()"></button>
  <button id="btnResetSemana" onclick="resetearFormulario()"></button>
  <div class="resultado" id="resultado"></div>
  <p class="error" id="errorSemana"><span class="icono">‚ö†Ô∏è</span></p>
</div>

<div class="seccion">
  <h3 class="texto-azul" id="h3Dias"></h3>
  <input type="date" id="fechaInicio">
  <span id="a-label">a</span>
  <input type="date" id="fechaFin">
  <button id="btnCalcularDias" onclick="calcularDias()"></button>
  <button id="btnResetDias" onclick="resetDias()"></button>
  <p class="resultado" id="resultadoDias"></p>
  <p class="error" id="errorDias"><span class="icono">‚ö†Ô∏è</span></p>
</div>

<div class="seccion">
  <h3 class="texto-azul" id="h3Rango"></h3>
  <label id="labelSemana" for="semanaInput"></label>
  <input type="number" id="semanaInput" min="1" max="53">
  <button id="btnMostrarRango" onclick="calcularRangoSemana()"></button>
  <button id="btnResetRango" onclick="resetSemana()"></button>
  <p class="resultado" id="resultadoSemana"></p>
  <p class="error" id="errorRangoSemana"><span class="icono">‚ö†Ô∏è</span></p>
</div>

<button id="modo-toggle" onclick="toggleModo()" aria-label="Cambiar modo claro/oscuro">‚òÄÔ∏é/‚òæ</button> 
  
<footer class="firma" id="footerFirma"></footer>

<script>
// --- Traducciones ---
const traducciones = {
  es: {
    titulo: "Calculadora de tiempo",
    h3Semana: "N√∫mero de semana",
    btnCalcularSemana: "Calcular semana",
    btnResetSemana: "Resetear",
    semanaDe: "{fecha} > Semana {semana}",
    diasEntre: "{total} d√≠as ({a√±os} a√±os, {meses} meses, {dias} d√≠as)",
    rangoSemana: "Semana {semana}: del {inicio} al {fin}",
    h3Dias: "Tiempo entre dos fechas",
    btnCalcularDias: "Calcular d√≠as",
    btnResetDias: "Resetear",
    h3Rango: "Fechas de una semana",
    labelSemana: "Semana del a√±o (1-53):",
    btnMostrarRango: "Mostrar rango",
    btnResetRango: "Resetear",
    placeholderInicio: "Fecha inicio",
    placeholderFin: "Fecha fin",
    placeholderSemana: "N√∫mero de semana",
    errorFecha: "Introduce una fecha v√°lida.",
    errorFechas: "Introduce fechas v√°lidas en ambos campos.",
    errorFinAntesInicio: "La fecha final no puede ser anterior a la inicial.",
    errorSemana: "Introduce un n√∫mero de semana v√°lido entre 1 y 53.",
    horaActual: "Hora actual:",
    zonaHorariaTpl: "Hora local de Espa√±a ({gmt})",
    semanaActual: "Hoy es {fecha} y estamos en la semana n√∫mero {semana} del a√±o.",
    footer: "El sitio podr√≠a cometer errores, considera contrastar la informaci√≥n. Calculadora de tiempo V4.5 por DGCSe7en - Github"
  },
  ca: {
    titulo: "Calculadora de temps",
    h3Semana: "N√∫mero de setmana",
    btnCalcularSemana: "Calcular setmana",
    btnResetSemana: "Restablir",
    semanaDe: "{fecha} > Setmana {semana}",
    diasEntre: "{total} dies ({a√±os} anys, {meses} mesos, {dias} dies)",
    rangoSemana: "Setmana {semana}: del {inicio} al {fin}",
    h3Dias: "Temps entre dues dates",
    btnCalcularDias: "Calcular dies",
    btnResetDias: "Restablir",
    h3Rango: "Dates d‚Äôuna setmana",
    labelSemana: "Setmana de l‚Äôany (1-53):",
    btnMostrarRango: "Mostrar interval",
    btnResetRango: "Restablir",
    placeholderInicio: "Data inici",
    placeholderFin: "Data fi",
    placeholderSemana: "N√∫mero de setmana",
    errorFecha: "Introdueix una data v√†lida.",
    errorFechas: "Introdueix dates v√†lides en tots dos camps.",
    errorFinAntesInicio: "La data final no pot ser anterior a la inicial.",
    errorSemana: "Introdueix un n√∫mero de setmana v√†lid entre 1 i 53.",
    horaActual: "Hora actual:",
    zonaHorariaTpl: "Hora local d'Espanya ({gmt})",
    semanaActual: "Avui √©s {fecha} i estem a la setmana n√∫mero {semana} de l‚Äôany.",
    footer: "El lloc podria contenir errors, considera contrastar la informaci√≥. Calculadora de temps V4.5 per DGCSe7en - Github"
  },
  gl: {
    titulo: "Calculadora de tempo",
    h3Semana: "N√∫mero de semana",
    btnCalcularSemana: "Calcular semana",
    btnResetSemana: "Restablecer",
    semanaDe: "{fecha} > Semana {semana}",
    diasEntre: "{total} d√≠as ({a√±os} anos, {meses} meses, {dias} d√≠as)",
    rangoSemana: "Semana {semana}: do {inicio} ao {fin}",
    h3Dias: "Tempo entre d√∫as datas",
    btnCalcularDias: "Calcular d√≠as",
    btnResetDias: "Restablecer",
    h3Rango: "Datas dunha semana",
    labelSemana: "Semana do ano (1-53):",
    btnMostrarRango: "Mostrar intervalo",
    btnResetRango: "Restablecer",
    placeholderInicio: "Data inicio",
    placeholderFin: "Data fin",
    placeholderSemana: "N√∫mero de semana",
    errorFecha: "Introduce unha data v√°lida.",
    errorFechas: "Introduce datas v√°lidas en ambos campos.",
    errorFinAntesInicio: "A data final non pode ser anterior √° inicial.",
    errorSemana: "Introduce un n√∫mero de semana v√°lido entre 1 e 53.",
    horaActual: "Hora actual:",
    zonaHorariaTpl: "Hora local de Espa√±a ({gmt})",
    semanaActual: "Hoxe √© {fecha} e estamos na semana n√∫mero {semana} do ano.",
    footer: "O sitio poder√≠a conter erros, considera contrastar a informaci√≥n. Calculadora de tempo V4.5 por DGCSe7en - Github"
  },
  eu: {
    titulo: "Denboraren kalkulagailua",
    h3Semana: "Aste zenbakia",
    btnCalcularSemana: "Astea kalkulatu",
    btnResetSemana: "Berrezarri",
    semanaDe: "{fecha} > {semana}. astea",
    diasEntre: "{total} egun ({a√±os} urte, {meses} hilabete, {dias} egun)",
    rangoSemana: "{semana}. astea: {inicio}tik {fin}ra",
    h3Dias: "Bi daten arteko denbora",
    btnCalcularDias: "Egunak kalkulatu",
    btnResetDias: "Berrezarri",
    h3Rango: "Aste bateko datak",
    labelSemana: "Urteko astea (1-53):",
    btnMostrarRango: "Tartea erakutsi",
    btnResetRango: "Berrezarri",
    placeholderInicio: "Hasiera data",
    placeholderFin: "Amaiera data",
    placeholderSemana: "Aste zenbakia",
    errorFecha: "Sartu baliozko data bat.",
    errorFechas: "Sartu baliozko datak bi eremuetan.",
    errorFinAntesInicio: "Amaiera data ezin da hasierakoa baino lehenagokoa izan.",
    errorSemana: "Sartu 1 eta 53 arteko aste-zenbaki baliozkoa.",
    horaActual: "Ordu orain:",
    zonaHorariaTpl: "Espainiako tokiko ordua ({gmt})",
    semanaActual: "Gaur {fecha} da eta urteko {semana}. astean gaude.",
    footer: "Guneak akatsak izan ditzake, kontrastatu informazioa. Denboraren kalkulagailua V4.5 DGCSe7en - Github"
  }
};

// --- Funciones auxiliares ---
function formatoFecha(fecha){ 
  const dia=String(fecha.getDate()).padStart(2,'0'); 
  const mes=String(fecha.getMonth()+1).padStart(2,'0'); 
  const a√±o=fecha.getFullYear(); 
  return `${dia}/${mes}/${a√±o}`; 
}

function obtenerGMTMadrid() {
  const diff = - (new Date().getTimezoneOffset());
  return (diff === 120) ? 'GMT+2' : 'GMT+1';
}

// --- Reloj ---
function actualizarReloj(){
  const ahora=new Date();
  const lang = document.querySelector('#idiomas img.active')?.dataset.lang || 'es';
  const t = traducciones[lang];
  document.getElementById("reloj").innerText =
    `${t.horaActual} ${ahora.toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false, timeZone:'Europe/Madrid'})}`;
  const gmt = obtenerGMTMadrid();
  document.getElementById("zonaHoraria").innerText =
    t.zonaHorariaTpl.replace("{gmt}", gmt);
}
setInterval(actualizarReloj,1000);

// --- Manejo de errores ---
function mostrarError(inputId,errorId,mensaje){
  const input = document.getElementById(inputId);
  const error = document.getElementById(errorId);
  if (input) input.classList.add('input-error');
  if (error) {
    error.innerHTML = `<span class="icono">‚ö†Ô∏è</span>${mensaje}`;
    error.classList.add('visible');
  }
  setTimeout(()=>{ if (input) input.classList.remove('input-error'); },1200);
  setTimeout(()=>{ if (error) error.classList.remove('visible'); },3000);
}

// --- Toggle modo claro/oscuro ---
function toggleModo(){
  const body=document.body;
  if(body.classList.contains('modo-oscuro')){
    body.classList.remove('modo-oscuro');
    body.classList.add('modo-claro');
    localStorage.setItem('modo','claro');
  }else{
    body.classList.remove('modo-claro');
    body.classList.add('modo-oscuro');
    localStorage.setItem('modo','oscuro');
  }
}

// --- Inicializaci√≥n ---
window.onload=function(){
  const modoGuardado=localStorage.getItem('modo');
  if(modoGuardado==='oscuro'){
    document.body.classList.add('modo-oscuro');
  } else {
    document.body.classList.add('modo-claro');
  }
  cambiarIdioma('es');
};

// --- Cambio de idioma ---
function cambiarIdioma(lang) {
  // Cambiar atributo lang en el HTML
  document.documentElement.lang = lang;

  // Quitar "active" de todas las banderas
  document.querySelectorAll('#idiomas img').forEach(img => {
    img.classList.remove('active');
  });
  // Poner "active" en la bandera seleccionada
  const img = document.querySelector(`#idiomas img[data-lang="${lang}"]`);
  if (img) img.classList.add('active');

  // Aplicar traducciones
  const t = traducciones[lang];
  if (!t) return; // seguridad extra

  document.getElementById('titulo').textContent = t.titulo;
  document.getElementById('h3Semana').textContent = t.h3Semana;
  document.getElementById('btnCalcularSemana').textContent = t.btnCalcularSemana;
  document.getElementById('btnResetSemana').textContent = t.btnResetSemana;
  document.getElementById('h3Dias').textContent = t.h3Dias;
  document.getElementById('btnCalcularDias').textContent = t.btnCalcularDias;
  document.getElementById('btnResetDias').textContent = t.btnResetDias;
  document.getElementById('h3Rango').textContent = t.h3Rango;
  document.getElementById('labelSemana').textContent = t.labelSemana;
  document.getElementById('btnMostrarRango').textContent = t.btnMostrarRango;
  document.getElementById('btnResetRango').textContent = t.btnResetRango;
  document.getElementById('footerFirma').textContent = t.footer;

  // Placeholders
  document.getElementById('fechaInicio').placeholder = t.placeholderInicio;
  document.getElementById('fechaFin').placeholder = t.placeholderFin;
  document.getElementById('semanaInput').placeholder = t.placeholderSemana;

  // Traducir el "a" entre fechas si lo quieres traducible
  document.getElementById('a-label').textContent = (lang === 'ca') ? 'a' : (lang === 'gl') ? 'a' : (lang === 'eu') ? 'eta' : 'a';

  // Mostrar semana actual en el idioma seleccionado
  mostrarSemanaActual(lang);

  // Limpiar resultados y errores visibles
  ['resultado', 'resultadoDias', 'resultadoSemana'].forEach(id => {
    if(document.getElementById(id)) document.getElementById(id).textContent = "";
  });
  ['errorSemana', 'errorDias', 'errorRangoSemana'].forEach(id => {
    if(document.getElementById(id)) document.getElementById(id).textContent = "";
  });

  // Actualizar reloj y zona horaria inmediatamente
  actualizarReloj();
}

// --- Funciones de c√°lculo ---
function getSemanaISO(fecha){
  const tmp = new Date(fecha.getTime());
  tmp.setHours(0,0,0,0);
  tmp.setDate(tmp.getDate() + 3 - (tmp.getDay() + 6) % 7);
  const primerJueves = new Date(tmp.getFullYear(),0,4);
  return 1 + Math.round(((tmp - primerJueves)/ (7 * 24 * 60 * 60 * 1000)));
}

function calcularSemana(){
  const fechaInput=document.getElementById("fecha").value;
  const lang = document.querySelector('#idiomas img.active')?.dataset.lang || 'es';
  const t = traducciones[lang];

  if(!fechaInput){ mostrarError("fecha","errorSemana",t.errorFecha); return; }
  const fecha=new Date(fechaInput);
  if(isNaN(fecha)){ mostrarError("fecha","errorSemana",t.errorFecha); return; }

  const semana=getSemanaISO(fecha);
  document.getElementById("resultado").innerText = t.semanaDe
    .replace("{fecha}", formatoFecha(fecha))
    .replace("{semana}", semana);
}

function resetearFormulario(){
  document.getElementById("fecha").value="";
  document.getElementById("resultado").innerText="";
  mostrarSemanaActual(document.querySelector('#idiomas img.active')?.dataset.lang || 'es');
}

function mostrarSemanaActual(lang){
  const hoy=new Date();
  const semanaActual=getSemanaISO(hoy);
  const t = traducciones[lang];
  document.getElementById("semanaActual").innerText = t.semanaActual
    .replace("{fecha}",formatoFecha(hoy))
    .replace("{semana}",semanaActual);
}

function calcularDias(){
  const inicioVal=document.getElementById("fechaInicio").value;
  const finVal=document.getElementById("fechaFin").value;
  const lang = document.querySelector('#idiomas img.active')?.dataset.lang || 'es';
  const t = traducciones[lang];

  if(!inicioVal || !finVal){
    mostrarError("fechaInicio","errorDias", t.errorFechas);
    return;
  }
  const fechaInicio=new Date(inicioVal);
  const fechaFin=new Date(finVal);
  if(isNaN(fechaInicio) || isNaN(fechaFin)){
    mostrarError("fechaInicio","errorDias", t.errorFechas);
    return;
  }
  if(fechaFin < fechaInicio){
    mostrarError("fechaFin","errorDias", t.errorFinAntesInicio);
    return;
  }

  let a√±os=fechaFin.getFullYear()-fechaInicio.getFullYear();
  let meses=fechaFin.getMonth()-fechaInicio.getMonth();
  let dias=fechaFin.getDate()-fechaInicio.getDate();
  if(dias<0){ 
    meses--; 
    dias+=new Date(fechaFin.getFullYear(),fechaFin.getMonth(),0).getDate(); 
  }
  if(meses<0){ 
    a√±os--; 
    meses+=12; 
  }
  const diasTotales=Math.round((fechaFin-fechaInicio)/(1000*60*60*24));
  document.getElementById("resultadoDias").textContent=t.diasEntre
    .replace("{total}", diasTotales)
    .replace("{a√±os}", a√±os)
    .replace("{meses}", meses)
    .replace("{dias}", dias);
}

function resetDias(){
  document.getElementById("fechaInicio").value="";
  document.getElementById("fechaFin").value="";
  document.getElementById("resultadoDias").textContent="";
  const err = document.getElementById("errorDias"); if (err) err.textContent = "";
}

function calcularRangoSemana(){
  const semanaInput = document.getElementById("semanaInput").value;
  const semana = parseInt(semanaInput, 10);
  const lang = document.querySelector('#idiomas img.active')?.dataset.lang || 'es';
  const t = traducciones[lang];

  if(isNaN(semana) || semana < 1 || semana > 53){
    mostrarError("semanaInput","errorRangoSemana", t.errorSemana);
    return;
  }

  const a√±o = new Date().getFullYear();
  const primerJueves = new Date(a√±o,0,4);
  const diaSemana = (primerJueves.getDay() + 6) % 7;
  const inicioSemana = new Date(primerJueves);
  inicioSemana.setDate(primerJueves.getDate() - diaSemana + (semana - 1) * 7);
  const finSemana = new Date(inicioSemana);
  finSemana.setDate(inicioSemana.getDate() + 6);

  document.getElementById("resultadoSemana").textContent=t.rangoSemana
    .replace("{semana}", semana)
    .replace("{inicio}", formatoFecha(inicioSemana))
    .replace("{fin}", formatoFecha(finSemana));
}

function resetSemana(){
  document.getElementById("semanaInput").value="";
  document.getElementById("resultadoSemana").textContent="";
  const err = document.getElementById("errorRangoSemana"); if (err) err.textContent = "";
}
// --- Traducciones espec√≠ficas de clima ---
const traduccionesClima = {
  es: { h3: "Clima", placeholder: "Introduce tu ciudad", btn: "Consultar", errorCiudad: "Introduce una ciudad v√°lida.", errorNoEncontrada: "Ciudad no encontrada.", errorAPI: "Error al obtener el clima." },
  ca: { h3: "Clima", placeholder: "Introdueix la ciutat", btn: "Consultar", errorCiudad: "Introdueix una ciutat v√†lida.", errorNoEncontrada: "Ciutat no trobada.", errorAPI: "Error en obtenir el clima." },
  gl: { h3: "Clima", placeholder: "Introduce a t√∫a cidade", btn: "Consultar", errorCiudad: "Introduce unha cidade v√°lida.", errorNoEncontrada: "Cidade non atopada.", errorAPI: "Erro ao obter o clima." },
  eu: { h3: "Klima", placeholder: "Sartu hiria", btn: "Kontsultatu", errorCiudad: "Sartu baliozko hiria.", errorNoEncontrada: "Hiria ez da aurkitu.", errorAPI: "Akatsa klimaren informazioa jasotzean." }
};

const apiKey = "6190233d77058dc3f79f839252cc0058";

// --- Funci√≥n principal para obtener clima ---
function obtenerClima() {
  const ciudad = document.getElementById('ciudad').value.trim();
  const lang = document.querySelector('#idiomas img.active')?.dataset.lang || 'es';
  const t = traduccionesClima[lang];
  const errorEl = document.getElementById('errorClima');
  const resultadoEl = document.getElementById('resultadoClima');

  errorEl.textContent = '';
  resultadoEl.textContent = '';
  resultadoEl.style.backgroundColor = 'transparent';

  if (!ciudad) {
    mostrarError('ciudad', 'errorClima', t.errorCiudad);
    return;
  }

  localStorage.setItem('ultimaCiudad', ciudad);

  fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(ciudad)}&appid=${apiKey}&units=metric&lang=${lang}`)
    .then(res => res.json())
    .then(data => {
      if (data.cod !== 200) {
        mostrarError('ciudad', 'errorClima', t.errorNoEncontrada);
        return;
      }

      const temp = data.main.temp;
      let colorFondo;
      if (temp <= 0) colorFondo = '#74c0fc';
      else if (temp <= 15) colorFondo = '#a5d8ff';
      else if (temp <= 25) colorFondo = '#fff3bf';
      else colorFondo = '#ff6b6b';

      const iconUrl = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
      resultadoEl.innerHTML = `
        <p><strong>${data.name}, ${data.sys.country}</strong></p>
        <p>üå°Ô∏è ${temp}¬∞C - ${data.weather[0].description}
           <img src="${iconUrl}" alt="${data.weather[0].description}" style="vertical-align:middle;">
        </p>
        <p>üå¨Ô∏è Viento: ${data.wind.speed} m/s</p>
      `;
      resultadoEl.style.backgroundColor = colorFondo;
      resultadoEl.style.padding = '10px';
      resultadoEl.style.borderRadius = '8px';

      mostrarAnimacionClima(data.weather[0].icon);
    })
    .catch(err => {
      mostrarError('ciudad', 'errorClima', t.errorAPI);
      console.error(err);
    });
}

// --- Bot√≥n consultar ---
document.getElementById('btnConsultarClima').addEventListener('click', obtenerClima);

// --- Cargar √∫ltima ciudad al iniciar ---
window.addEventListener('load', () => {
  const ciudadGuardada = localStorage.getItem('ultimaCiudad');
  if (ciudadGuardada) {
    document.getElementById('ciudad').value = ciudadGuardada;
    obtenerClima();
  }
});

// --- Actualizar traducciones de clima seg√∫n idioma ---
function actualizarClimaIdioma(lang) {
  const t = traduccionesClima[lang];
  document.getElementById('h3Clima').textContent = t.h3;
  document.getElementById('ciudad').placeholder = t.placeholder;
  document.getElementById('btnConsultarClima').textContent = t.btn;
}

// Integrar con cambiarIdioma
const originalCambiarIdioma = cambiarIdioma;
cambiarIdioma = function(lang) {
  originalCambiarIdioma(lang);
  actualizarClimaIdioma(lang);
};

// --- Animaciones seg√∫n el clima ---
function mostrarAnimacionClima(iconCode) {
  const anim = document.getElementById('climaAnimado');
  anim.innerHTML = '';

  if (iconCode.startsWith('01')) { // cielo despejado
    const sol = document.createElement('div');
    sol.className = 'sol';
    anim.appendChild(sol);
  } 
  else if (iconCode.startsWith('02') || iconCode.startsWith('03') || iconCode.startsWith('04')) { // nubes
    for (let i=0; i<3; i++) {
      const nube = document.createElement('div');
      nube.className = 'nube';
      nube.style.top = `${20 + i*20}px`;
      nube.style.animationDelay = `${i*2}s`;
      anim.appendChild(nube);
    }
  } 
  else if (iconCode.startsWith('09') || iconCode.startsWith('10')) { // lluvia
    for (let i=0; i<20; i++) {
      const gota = document.createElement('div');
      gota.className = 'gota';
      gota.style.left = `${i*5}%`;
      gota.style.animationDelay = `${Math.random()*1}s`;
      anim.appendChild(gota);
    }
  } 
  else if (iconCode.startsWith('13')) { // nieve
    for (let i=0; i<20; i++) {
      const copo = document.createElement('div');
      copo.className = 'nieve';
      copo.style.left = `${i*5}%`;
      copo.style.animationDelay = `${Math.random()*2}s`;
      anim.appendChild(copo);
    }
  } 
  else { // nublado gen√©rico
    const nube = document.createElement('div');
    nube.className = 'nube';
    anim.appendChild(nube);
  }
}
</script>
</body>
</html>
